<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ pet_name }} - äº‘ç«¯çºªå¿µé¦†</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: #333;
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }
        .memorial-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        .header {
            background: linear-gradient(135deg, #5e72e4 0%, #825ee4 100%);
            color: white;
            text-align: center;
            padding: 30px 20px;
            position: relative;
        }
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .theme-status-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .theme-status-btn:hover {
            background: rgba(255, 255, 255, 1);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        .pet-info {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            padding: 20px;
            background: #f8f9fe;
            border-bottom: 1px solid #eee;
        }
        .info-item {
            text-align: center;
            padding: 10px;
            min-width: 150px;
        }
        .info-item h3 {
            color: #6c757d;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }
        .info-item p {
            font-size: 1.1rem;
            font-weight: 500;
            color: #525f7f;
        }
        .photo-gallery {
            padding: 30px 20px;
        }
        .gallery-title {
            text-align: center;
            margin-bottom: 25px;
            color: #5e72e4;
            font-size: 1.8rem;
        }
        .photos {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
        }
        .photo-item {
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            height: 200px;
            transition: transform 0.3s ease;
        }
        .photo-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }
        .photo-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        /* AIä¿¡ä»¶æ ·å¼ */
        .ai-letter-section {
            margin: 30px 20px;
            padding: 25px;
            background: linear-gradient(135deg, #fff9e6 0%, #fff4d6 100%);
            border-radius: 15px;
            border: 1px solid #f0e6cc;
        }
        
        .letter-content {
            margin-top: 20px;
        }
        
        .letter-paper {
            background: #ffffff;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #ffd700;
            position: relative;
        }
        
        .letter-paper:before {
            content: "âœ‰ï¸";
            position: absolute;
            top: -10px;
            right: -10px;
            font-size: 24px;
            background: #ffd700;
            padding: 8px;
            border-radius: 50%;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }
        
        .letter-text {
            font-size: 1.1rem;
            line-height: 1.8;
            color: #5a5a5a;
            font-family: 'Georgia', serif;
        }

        /* æ€§æ ¼æµ‹è¯•ç»“æœæ ·å¼ */
        .personality-section {
            margin: 30px 20px;
            padding: 25px;
            background: linear-gradient(135deg, #e8f4f8 0%, #d6eaf8 100%);
            border-radius: 15px;
            border: 1px solid #bee5eb;
        }
        
        .personality-content {
            margin-top: 20px;
        }
        
        .personality-type {
            background: #ffffff;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #17a2b8;
        }
        
        .personality-type h3 {
            color: #17a2b8;
            font-size: 1.4rem;
            margin-bottom: 15px;
        }
        
        .personality-desc {
            color: #5a5a5a;
            font-size: 1.1rem;
            line-height: 1.6;
        }

        /* ç•™è¨€åŒºåŸŸæ ·å¼ */
        .messages-section {
            padding: 30px 20px;
            background: #f8f9fe;
        }
        
        .section-title {
            text-align: center;
            margin-bottom: 25px;
            color: #5e72e4;
            font-size: 1.8rem;
        }
        
        .message-form {
            max-width: 600px;
            margin: 0 auto 30px;
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .message-form input,
        .message-form textarea {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }
        
        .message-form input:focus,
        .message-form textarea:focus {
            outline: none;
            border-color: #5e72e4;
        }
        
        .message-form textarea {
            height: 100px;
            resize: vertical;
        }
        
        .message-form button {
            background: linear-gradient(135deg, #5e72e4 0%, #825ee4 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }
        
        .message-form button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(94, 114, 228, 0.3);
        }
        
        .messages-list {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .message-item {
            background: white;
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }
        
        .message-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .visitor-name {
            font-weight: 600;
            color: #5e72e4;
        }
        
        .message-time {
            font-size: 0.9rem;
            color: #999;
        }
        
        .message-content {
            color: #333;
            line-height: 1.6;
        }
        
        /* åˆ†äº«åŒºåŸŸæ ·å¼ */
        .share-section {
            padding: 30px 20px;
            background: white;
            text-align: center;
        }
        
        .share-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            margin-top: 20px;
        }
        
        .share-btn {
            background: #f8f9fa;
            border: 2px solid #e1e5e9;
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #333;
        }
        
        .share-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .share-btn.wechat:hover {
            background: #07c160;
            border-color: #07c160;
            color: white;
        }
        
        .share-btn.qq:hover {
            background: #12b7f5;
            border-color: #12b7f5;
            color: white;
        }
        
        .share-btn.weibo:hover {
            background: #e6162d;
            border-color: #e6162d;
            color: white;
        }
        
        .share-btn.copy:hover {
            background: #6c757d;
            border-color: #6c757d;
            color: white;
        }
        
        /* ä¸»é¢˜é€‰æ‹©åŒºåŸŸæ ·å¼ */
        .theme-section {
            padding: 30px 20px;
            background: #f0f8ff;
            text-align: center;
        }
        
        .theme-content {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .theme-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .theme-option {
            background: white;
            border-radius: 15px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .theme-option:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            border-color: #667eea;
        }
        
        .theme-option.selected {
            border-color: #667eea;
            background: #e8f0fe;
        }
        
        .theme-preview {
            width: 100%;
            height: 60px;
            border-radius: 10px;
            margin-bottom: 10px;
        }
        
        .theme-name {
            font-size: 0.9rem;
            color: #333;
            font-weight: 500;
        }
        
        /* ä¸»é¢˜é¢„è§ˆæ ·å¼ */
        .theme-preview.warm {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
        }
        
        .theme-preview.elegant {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
        }
        
        .theme-preview.nature {
            background: linear-gradient(135deg, #d299c2 0%, #fef9d7 100%);
        }
        
        .theme-preview.modern {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }
        
        .theme-preview.classic {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
        }
        
        .theme-preview.simple {
            background: linear-gradient(135deg, #a8caba 0%, #5d4e75 100%);
        }
        
        /* å¿ƒæƒ…æ—¥è®°æ ·å¼ */
        .mood-diary-section {
            padding: 30px 20px;
            background: #fff5f5;
            text-align: center;
        }
        
        .mood-diary-form {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .mood-inputs {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .mood-select {
            padding: 10px 15px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 1rem;
            background: white;
        }
        
        .mood-slider {
            width: 120px;
            height: 6px;
            border-radius: 3px;
            background: #e1e5e9;
            outline: none;
        }
        
        .mood-slider::-webkit-slider-thumb {
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
        }
        
        #moodScoreDisplay {
            font-weight: 600;
            color: #667eea;
            min-width: 30px;
        }
        
        #diaryContent {
            width: 100%;
            padding: 15px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 1rem;
            resize: vertical;
            margin-bottom: 15px;
        }
        
        .weather-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 1rem;
            margin-bottom: 20px;
        }
        
        .diary-submit-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .diary-submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }
        
        .mood-diaries-list {
            margin-top: 30px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .mood-diary-item {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            text-align: left;
        }
        
        .mood-diary-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .mood-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .mood-emoji {
            font-size: 1.5rem;
        }
        
        .mood-score {
            background: #667eea;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .diary-time {
            color: #666;
            font-size: 0.9rem;
        }
        
        .diary-content {
            margin-bottom: 10px;
            line-height: 1.6;
        }
        
        .diary-weather {
            color: #888;
            font-size: 0.9rem;
            font-style: italic;
        }
        
        /* ç…§ç‰‡è½®æ’­æ ·å¼ */
        .photo-carousel-section {
            padding: 30px 20px;
            background: #f8f9fe;
            text-align: center;
        }
        
        .carousel-container {
            position: relative;
            max-width: 600px;
            margin: 0 auto;
            overflow: hidden;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .carousel-wrapper {
            display: flex;
            transition: transform 0.5s ease;
        }
        
        .carousel-slide {
            min-width: 100%;
            height: 400px;
            position: relative;
        }
        
        .carousel-slide img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .carousel-btn {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.9);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s ease;
            z-index: 10;
        }
        
        .carousel-btn:hover {
            background: white;
            transform: translateY(-50%) scale(1.1);
        }
        
        .carousel-btn.prev {
            left: 10px;
        }
        
        .carousel-btn.next {
            right: 10px;
        }
        
        .carousel-dots {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 15px;
        }
        
        .carousel-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #ccc;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .carousel-dot.active {
            background: #667eea;
        }
        
        /* è®¿é—®ç»Ÿè®¡æ ·å¼ */
        .visit-stats-section {
            padding: 30px 20px;
            background: #f0f8ff;
            text-align: center;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .stat-item {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 10px;
        }
        
        .stat-label {
            color: #666;
            font-size: 1rem;
        }
        

        

        

        
        /* åŠ¨æ€å¤©æ°”ä¸»é¢˜æ ·å¼ */
        .weather-theme-section {
            padding: 30px 20px;
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            color: white;
            text-align: center;
        }
        
        .weather-content {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .weather-info {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 30px;
            margin-bottom: 30px;
            align-items: center;
        }
        
        .current-weather {
            display: flex;
            align-items: center;
            gap: 20px;
            background: rgba(255, 255, 255, 0.1);
            padding: 25px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .weather-icon {
            font-size: 3rem;
        }
        
        .weather-details {
            text-align: left;
        }
        
        .weather-location {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .weather-temp {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .weather-desc {
            font-size: 1rem;
            opacity: 0.9;
        }
        
        .weather-controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .weather-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            padding: 12px 20px;
            border-radius: 25px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        .weather-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.6);
            transform: translateY(-2px);
        }
        
        .weather-effects {
            min-height: 100px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }
        
        .weather-themes h3 {
            margin-bottom: 20px;
            color: #ffd700;
        }
        
        .theme-preview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .weather-theme-preview {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .weather-theme-preview:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-5px);
        }
        
        .theme-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .theme-name {
            font-size: 1rem;
            font-weight: 600;
        }
        
        /* å¤©æ°”ç‰¹æ•ˆæ ·å¼ */
        .rain-drop {
            position: absolute;
            width: 2px;
            height: 20px;
            background: linear-gradient(to bottom, transparent, #74b9ff);
            animation: rain-fall linear infinite;
        }
        
        .snowflake {
            position: absolute;
            color: white;
            font-size: 1rem;
            animation: snow-fall linear infinite;
        }
        
        .sun-ray {
            position: absolute;
            width: 3px;
            height: 40px;
            background: linear-gradient(to bottom, #ffd700, transparent);
            animation: sun-shine linear infinite;
        }

        
        /* æé†’åŒºåŸŸæ ·å¼ */
        .reminder-section {
            padding: 30px 20px;
            background: #fff5f5;
            text-align: center;
        }
        
        .reminder-content {
            max-width: 600px;
            margin: 0 auto;
        }
        
        .reminder-btn {
            background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .reminder-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(245, 101, 101, 0.3);
        }

        .footer {
            text-align: center;
            padding: 20px;
            background: #2d3748;
            color: white;
        }
        .stars-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        .star {
            position: absolute;
            background-color: white;
            border-radius: 50%;
            animation: twinkle 3s infinite ease-in-out;
        }
        @keyframes twinkle {
            0%, 100% { opacity: 0.2; }
            50% { opacity: 1; }
        }
        /* ä¸»é¢˜æ ·å¼å®šä¹‰ */
        .theme-warm .header {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
        }
        .theme-warm .message-form button,
        .theme-warm .reminder-btn {
            background: linear-gradient(135deg, #fcb69f 0%, #ffecd2 100%);
        }
        .theme-warm .section-title {
            color: #d2691e;
        }

        
        .theme-elegant .header {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
        }
        .theme-elegant .message-form button,
        .theme-elegant .reminder-btn {
            background: linear-gradient(135deg, #fed6e3 0%, #a8edea 100%);
        }
        .theme-elegant .section-title {
            color: #20b2aa;
        }

        
        .theme-nature .header {
            background: linear-gradient(135deg, #d299c2 0%, #fef9d7 100%);
        }
        .theme-nature .message-form button,
        .theme-nature .reminder-btn {
            background: linear-gradient(135deg, #d299c2 0%, #fef9d7 100%);
        }
        .theme-nature .section-title {
            color: #8b4513;
        }

        
        .theme-modern .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }
        .theme-modern .message-form button,
        .theme-modern .reminder-btn {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }
        .theme-modern .section-title {
            color: #1e90ff;
        }

        
        .theme-classic .header {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
        }
        .theme-classic .message-form button,
        .theme-classic .reminder-btn {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
        }
        .theme-classic .section-title {
            color: #c71585;
        }

        
        .theme-simple .header {
            background: linear-gradient(135deg, #a8caba 0%, #5d4e75 100%);
        }
        .theme-simple .message-form button,
        .theme-simple .reminder-btn {
            background: linear-gradient(135deg, #a8caba 0%, #5d4e75 100%);
        }
        .theme-simple .section-title {
            color: #556b2f;
        }

        
        @media (max-width: 600px) {
            .header h1 { font-size: 2rem; }
            .info-item { min-width: 120px; }
            .photos { grid-template-columns: 1fr; }
            .theme-grid { grid-template-columns: repeat(3, 1fr); }
        }
    </style>
</head>
<body>
    <div class="memorial-container">
        <div class="header">
            <h1>{{ pet_name }}</h1>
            <p>æ°¸è¿œåœ¨æˆ‘ä»¬å¿ƒä¸­é—ªçƒçš„æ˜Ÿæ˜Ÿ</p>
            <div class="stars-container" id="stars"></div>
            <div class="theme-status-btn" id="themeStatusBtn">ğŸ¨ é€‰æ‹©ä¸»é¢˜</div>
        </div>
        
        <div class="pet-info">
            <div class="info-item">
                <h3>ç‰©ç§</h3>
                <p>{{ species }}</p>
            </div>
            <div class="info-item">
                <h3>çºªå¿µæ—¥</h3>
                <p>{{ memorial_date }}</p>
            </div>
        </div>
        
        <div class="photo-gallery">
            <h2 class="gallery-title">ç¾å¥½çš„å›å¿†</h2>
            <div class="photos">
                {% for photo in photos %}
                <div class="photo-item">
                    <img src="{{ photo }}" alt="{{ pet_name }}çš„ç…§ç‰‡">
                </div>
                {% endfor %}
            </div>
        </div>
        
        <!-- AIä¿¡ä»¶åŒºåŸŸ -->
        {% if ai_letter %}
        <div class="ai-letter-section">
            <h2 class="section-title">ğŸ’Œ æ¥è‡ª{{ pet_name }}çš„ä¿¡</h2>
            <div class="letter-content">
                <div class="letter-paper">
                    <div class="letter-text">{{ ai_letter|replace('\n', '<br>')|safe }}</div>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- æ€§æ ¼æµ‹è¯•ç»“æœ -->
        {% if personality_type %}
        <div class="personality-section">
            <h2 class="section-title">ğŸŒŸ æ€§æ ¼åˆ†æ</h2>
            <div class="personality-content">
                <div class="personality-type">
                    <h3>æ€§æ ¼ç±»å‹ï¼š{{ personality_type }}</h3>
                    {% if personality_description %}
                    <p class="personality-desc">{{ personality_description }}</p>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endif %}

        <!-- è®¿å®¢ç•™è¨€åŒº -->
        <div class="messages-section">
            <h2 class="section-title">è®¿å®¢ç•™è¨€</h2>
            <div class="message-form">
                <input type="text" id="visitorName" placeholder="æ‚¨çš„å§“å" maxlength="20">
                <textarea id="messageText" placeholder="ç•™ä¸‹æ‚¨å¯¹{{ pet_name }}çš„æ€å¿µå’Œç¥ç¦..." maxlength="500"></textarea>
                <button onclick="submitMessage()">å‘è¡¨ç•™è¨€</button>
            </div>
            <div class="messages-list" id="messagesList">
                <!-- ç•™è¨€å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
            </div>
        </div>
        
        <!-- ä¸»é¢˜é€‰æ‹©åŒº -->
        <div class="theme-section">
            <h2 class="section-title">é€‰æ‹©çºªå¿µé¦†ä¸»é¢˜</h2>
            <div class="theme-content">
                <p style="text-align: center; margin-bottom: 20px; color: #666;">
                    ä¸ºæ‚¨çš„å® ç‰©é€‰æ‹©æœ€åˆé€‚çš„çºªå¿µé£æ ¼
                </p>
                <div class="theme-grid">
                    <div class="theme-option" onclick="applyTheme('warm')">
                        <div class="theme-preview warm"></div>
                        <div class="theme-name">æ¸©é¦¨å›å¿†</div>
                    </div>
                    <div class="theme-option" onclick="applyTheme('elegant')">
                        <div class="theme-preview elegant"></div>
                        <div class="theme-name">ä¼˜é›…æ°¸æ’</div>
                    </div>
                    <div class="theme-option" onclick="applyTheme('nature')">
                        <div class="theme-preview nature"></div>
                        <div class="theme-name">è‡ªç„¶å’Œè°</div>
                    </div>
                    <div class="theme-option" onclick="applyTheme('modern')">
                        <div class="theme-preview modern"></div>
                        <div class="theme-name">ç°ä»£ç®€çº¦</div>
                    </div>
                    <div class="theme-option" onclick="applyTheme('classic')">
                        <div class="theme-preview classic"></div>
                        <div class="theme-name">ç»å…¸æ°¸æ’</div>
                    </div>
                    <div class="theme-option" onclick="applyTheme('simple')">
                        <div class="theme-preview simple"></div>
                        <div class="theme-name">æç®€ä¸»ä¹‰</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- çºªå¿µæ—¥æé†’åŒº -->
        <div class="reminder-section">
            <h2 class="section-title">çºªå¿µæ—¥æé†’</h2>
            <div class="reminder-content">
                <p style="text-align: center; margin-bottom: 20px; color: #666;">
                    è®¾ç½®é‡è¦çš„çºªå¿µæ—¥æœŸï¼Œæˆ‘ä»¬ä¼šåœ¨ç‰¹æ®Šæ—¥å­æé†’æ‚¨
                </p>
                <div style="text-align: center;">
                    <button class="reminder-btn" onclick="openReminderSetup()">
                        ğŸ“… è®¾ç½®æé†’
                    </button>
                </div>
            </div>
        </div>
        
        <!-- å¿ƒæƒ…æ—¥è®°åŒº -->
        <div class="mood-diary-section">
            <h2 class="section-title">å¿ƒæƒ…æ—¥è®°</h2>
            <div class="mood-diary-content">
                <p style="text-align: center; margin-bottom: 20px; color: #666;">
                    è®°å½•æ‚¨å¯¹å® ç‰©çš„æ€å¿µå’Œå¿ƒæƒ…
                </p>
                <div class="mood-diary-form">
                    <div class="mood-inputs">
                        <select id="moodType" class="mood-select">
                            <option value="happy">ğŸ˜Š å¼€å¿ƒ</option>
                            <option value="sad">ğŸ˜¢ éš¾è¿‡</option>
                            <option value="peaceful">ğŸ˜Œ å¹³é™</option>
                            <option value="nostalgic">ğŸ¥º æ€€å¿µ</option>
                            <option value="grateful">ğŸ™ æ„Ÿæ©</option>
                        </select>
                        <input type="range" id="moodScore" min="1" max="10" value="5" class="mood-slider">
                        <span id="moodScoreDisplay">5</span>
                    </div>
                    <textarea id="diaryContent" placeholder="å†™ä¸‹æ‚¨ä»Šå¤©çš„å¿ƒæƒ…..." rows="3"></textarea>
                    <input type="text" id="weather" placeholder="ä»Šå¤©çš„å¤©æ°”ï¼ˆå¯é€‰ï¼‰" class="weather-input">
                    <button onclick="addMoodDiary()" class="diary-submit-btn">è®°å½•å¿ƒæƒ…</button>
                </div>
                <div class="mood-diaries-list" id="moodDiariesList">
                    <!-- å¿ƒæƒ…æ—¥è®°å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
                </div>
            </div>
        </div>
        
        <!-- ç…§ç‰‡è½®æ’­åŒº -->
        <div class="photo-carousel-section">
            <h2 class="section-title">ç…§ç‰‡è½®æ’­</h2>
            <div class="carousel-container">
                <div class="carousel-wrapper" id="carouselWrapper">
                    <!-- ç…§ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
                </div>
                <button class="carousel-btn prev" onclick="changeSlide(-1)">â®</button>
                <button class="carousel-btn next" onclick="changeSlide(1)">â¯</button>
                <div class="carousel-dots" id="carouselDots">
                    <!-- è½®æ’­ç‚¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
        </div>
        
        <!-- è®¿é—®ç»Ÿè®¡åŒº -->
        <div class="visit-stats-section">
            <h2 class="section-title">è®¿é—®ç»Ÿè®¡</h2>
            <div class="stats-content">
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-number" id="totalVisits">0</div>
                        <div class="stat-label">æ€»è®¿é—®é‡</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="uniqueVisitors">0</div>
                        <div class="stat-label">ç‹¬ç«‹è®¿å®¢</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="lastVisit">-</div>
                        <div class="stat-label">æœ€åè®¿é—®</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ç¤¾äº¤åˆ†äº«åŒº -->
        <div class="share-section">
            <h2 class="section-title">åˆ†äº«çºªå¿µé¦†</h2>
            <div class="share-buttons">
                <button class="share-btn wechat" onclick="shareToWechat()">
                    <span>å¾®ä¿¡</span>
                </button>
                <button class="share-btn qq" onclick="shareToQQ()">
                    <span>QQ</span>
                </button>
                <button class="share-btn weibo" onclick="shareToWeibo()">
                    <span>å¾®åš</span>
                </button>
                <button class="share-btn copy" onclick="copyLink()">
                    <span>å¤åˆ¶é“¾æ¥</span>
                </button>
            </div>
        </div>
        
        <div class="footer">
            <p>å® å¿†æ˜ŸÂ·äº‘çºªå¿µé¦† Â· è®©çˆ±æ°¸æ’</p>
            <p>Â© {{ current_year }} PetMemory Star</p>
        </div>
    </div>

    <script>
        // åˆ›å»ºæ˜Ÿæ˜ŸèƒŒæ™¯
        function createStars() {
            const container = document.getElementById('stars');
            const starCount = 50;
            
            for (let i = 0; i < starCount; i++) {
                const star = document.createElement('div');
                star.classList.add('star');
                
                // éšæœºä½ç½®å’Œå¤§å°
                const size = Math.random() * 3 + 1;
                star.style.width = `${size}px`;
                star.style.height = `${size}px`;
                star.style.left = `${Math.random() * 100}%`;
                star.style.top = `${Math.random() * 100}%`;
                
                // éšæœºåŠ¨ç”»å‚æ•°
                const duration = Math.random() * 3 + 2;
                const delay = Math.random() * 5;
                star.style.animation = `twinkle ${duration}s infinite ${delay}s`;
                
                container.appendChild(star);
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆ›å»ºæ˜Ÿæ˜Ÿ
        window.addEventListener('load', createStars);
        
        // é¡µé¢åŠ è½½å®ŒæˆååŠ è½½ç•™è¨€
        window.addEventListener('load', loadMessages);
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–æ–°åŠŸèƒ½
        window.addEventListener('load', function() {
            initMoodDiary();
            initPhotoCarousel();
            loadVisitStats();
            recordVisit();
        });
        
        // è·å–çºªå¿µé¦†ID
        function getMemorialId() {
            const path = window.location.pathname;
            const match = path.match(/\/memorial\/(.+)/);
            return match ? match[1] : null;
        }
        
        // åŠ è½½ç•™è¨€
        async function loadMessages() {
            const memorialId = getMemorialId();
            if (!memorialId) return;
            
            try {
                const response = await fetch(`/api/messages/${memorialId}`);
                const data = await response.json();
                
                if (data.success) {
                    displayMessages(data.messages);
                }
            } catch (error) {
                console.error('åŠ è½½ç•™è¨€å¤±è´¥:', error);
            }
        }
        
        // æ˜¾ç¤ºç•™è¨€
        function displayMessages(messages) {
            const messagesList = document.getElementById('messagesList');
            if (!messagesList) return;
            
            if (messages.length === 0) {
                messagesList.innerHTML = '<p style="text-align: center; color: #999; padding: 20px;">è¿˜æ²¡æœ‰ç•™è¨€ï¼Œå¿«æ¥ç•™ä¸‹æ‚¨çš„æ€å¿µå§...</p>';
                return;
            }
            
            messagesList.innerHTML = messages.map(msg => `
                <div class="message-item">
                    <div class="message-header">
                        <span class="visitor-name">${msg.visitor_name}</span>
                        <span class="message-time">${formatTime(msg.created_at)}</span>
                    </div>
                    <div class="message-content">${msg.message}</div>
                </div>
            `).join('');
        }
        
        // æäº¤ç•™è¨€
        async function submitMessage() {
            const visitorName = document.getElementById('visitorName').value.trim();
            const messageText = document.getElementById('messageText').value.trim();
            const memorialId = getMemorialId();
            
            if (!visitorName || !messageText) {
                alert('è¯·å¡«å†™å§“åå’Œç•™è¨€å†…å®¹');
                return;
            }
            
            if (!memorialId) {
                alert('æ— æ³•è·å–çºªå¿µé¦†ä¿¡æ¯');
                return;
            }
            
            try {
                const formData = new FormData();
                formData.append('memorial_id', memorialId);
                formData.append('visitor_name', visitorName);
                formData.append('message', messageText);
                
                const response = await fetch('/api/message', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert('ç•™è¨€å‘è¡¨æˆåŠŸï¼');
                    document.getElementById('visitorName').value = '';
                    document.getElementById('messageText').value = '';
                    loadMessages(); // é‡æ–°åŠ è½½ç•™è¨€
                } else {
                    alert('ç•™è¨€å‘è¡¨å¤±è´¥ï¼š' + data.error);
                }
            } catch (error) {
                console.error('æäº¤ç•™è¨€å¤±è´¥:', error);
                alert('ç•™è¨€å‘è¡¨å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
            }
        }
        
        // æ ¼å¼åŒ–æ—¶é—´
        function formatTime(timeStr) {
            if (!timeStr) return '';
            const date = new Date(timeStr);
            return date.toLocaleString('zh-CN');
        }
        
        // ç¤¾äº¤åˆ†äº«åŠŸèƒ½
        function shareToWechat() {
            // ç”ŸæˆäºŒç»´ç æˆ–æç¤ºç”¨æˆ·æ‰‹åŠ¨åˆ†äº«
            alert('è¯·æˆªå›¾åˆ†äº«åˆ°å¾®ä¿¡');
        }
        
        function shareToQQ() {
            const url = window.location.href;
            const title = document.title;
            const shareUrl = `https://connect.qq.com/widget/shareqq/index.html?url=${encodeURIComponent(url)}&title=${encodeURIComponent(title)}`;
            window.open(shareUrl, '_blank');
        }
        
        function shareToWeibo() {
            const url = window.location.href;
            const title = document.title;
            const shareUrl = `https://service.weibo.com/share/share.php?url=${encodeURIComponent(url)}&title=${encodeURIComponent(title)}`;
            window.open(shareUrl, '_blank');
        }
        
        function copyLink() {
            const url = window.location.href;
            navigator.clipboard.writeText(url).then(() => {
                alert('é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            }).catch(() => {
                // é™çº§æ–¹æ¡ˆ
                const textArea = document.createElement('textarea');
                textArea.value = url;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            });
        }
        
        // åº”ç”¨ä¸»é¢˜
        function applyTheme(themeName) {
            // ç§»é™¤æ‰€æœ‰ä¸»é¢˜çš„é€‰ä¸­çŠ¶æ€
            document.querySelectorAll('.theme-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            // æ·»åŠ å½“å‰ä¸»é¢˜çš„é€‰ä¸­çŠ¶æ€
            event.currentTarget.classList.add('selected');
            
            // ä¿å­˜é€‰æ‹©çš„ä¸»é¢˜åˆ°localStorage
            localStorage.setItem('selectedTheme', themeName);
            
            // åº”ç”¨ä¸»é¢˜æ ·å¼
            applyThemeStyles(themeName);
            
            // æ˜¾ç¤ºæˆåŠŸæç¤º
            showThemeSuccess(themeName);
            
            // æ›´æ–°ä¸»é¢˜çŠ¶æ€æ˜¾ç¤º
            updateThemeStatus(themeName);
        }
        
        // åº”ç”¨ä¸»é¢˜æ ·å¼
        function applyThemeStyles(themeName) {
            const container = document.querySelector('.memorial-container');
            
            // ç§»é™¤æ‰€æœ‰ä¸»é¢˜ç±»
            container.classList.remove('theme-warm', 'theme-elegant', 'theme-nature', 'theme-modern', 'theme-classic', 'theme-simple');
            
            // æ·»åŠ æ–°ä¸»é¢˜ç±»
            container.classList.add(`theme-${themeName}`);
        }
        
        // æ˜¾ç¤ºä¸»é¢˜åº”ç”¨æˆåŠŸæç¤º
        function showThemeSuccess(themeName) {
            const themeNames = {
                'warm': 'æ¸©é¦¨å›å¿†',
                'elegant': 'ä¼˜é›…æ°¸æ’',
                'nature': 'è‡ªç„¶å’Œè°',
                'modern': 'ç°ä»£ç®€çº¦',
                'classic': 'ç»å…¸æ°¸æ’',
                'simple': 'æç®€ä¸»ä¹‰'
            };
            
            // åˆ›å»ºæç¤ºå…ƒç´ 
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                padding: 15px 25px;
                border-radius: 10px;
                box-shadow: 0 10px 25px rgba(0,0,0,0.2);
                z-index: 1000;
                font-size: 14px;
                transform: translateX(100%);
                transition: transform 0.3s ease;
            `;
            notification.textContent = `âœ… å·²åº”ç”¨"${themeNames[themeName]}"ä¸»é¢˜`;
            
            document.body.appendChild(notification);
            
            // æ˜¾ç¤ºåŠ¨ç”»
            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
            }, 100);
            
            // è‡ªåŠ¨éšè—
            setTimeout(() => {
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }
        
        // æ›´æ–°ä¸»é¢˜çŠ¶æ€æ˜¾ç¤º
        function updateThemeStatus(themeName) {
            const statusBtn = document.getElementById('themeStatusBtn');
            if (statusBtn) {
                statusBtn.innerHTML = `âœ… å·²åº”ç”¨"${getThemeDisplayName(themeName)}"ä¸»é¢˜`;
                statusBtn.className = `theme-status-btn theme-${themeName}`;
            }
        }
        
        // è·å–ä¸»é¢˜æ˜¾ç¤ºåç§°
        function getThemeDisplayName(themeName) {
            const themeNames = {
                'warm': 'æ¸©é¦¨å›å¿†',
                'elegant': 'ä¼˜é›…æ°¸æ’',
                'nature': 'è‡ªç„¶å’Œè°',
                'modern': 'ç°ä»£ç®€çº¦',
                'classic': 'ç»å…¸æ°¸æ’',
                'simple': 'æç®€ä¸»ä¹‰'
            };
            return themeNames[themeName] || themeName;
        }
        
        // é¡µé¢åŠ è½½æ—¶åº”ç”¨ä¿å­˜çš„ä¸»é¢˜
        window.addEventListener('load', function() {
            const savedTheme = localStorage.getItem('selectedTheme');
            if (savedTheme) {
                applyThemeStyles(savedTheme);
                // æ ‡è®°å¯¹åº”çš„ä¸»é¢˜é€‰é¡¹ä¸ºé€‰ä¸­çŠ¶æ€
                const themeOption = document.querySelector(`[onclick="applyTheme('${savedTheme}')"]`);
                if (themeOption) {
                    themeOption.classList.add('selected');
                }
                // æ›´æ–°ä¸»é¢˜çŠ¶æ€æ˜¾ç¤º
                updateThemeStatus(savedTheme);
            }
        });
        
        // æ‰“å¼€æé†’è®¾ç½®é¡µé¢
        function openReminderSetup() {
            const memorialId = getMemorialId();
            if (memorialId) {
                window.open(`/reminder-setup?memorial_id=${memorialId}`, '_blank');
            } else {
                alert('æ— æ³•è·å–çºªå¿µé¦†ä¿¡æ¯');
            }
        }
        
        // ========== å¿ƒæƒ…æ—¥è®°åŠŸèƒ½ ==========
        function initMoodDiary() {
            // åˆå§‹åŒ–å¿ƒæƒ…è¯„åˆ†æ»‘å—æ˜¾ç¤º
            const moodSlider = document.getElementById('moodScore');
            const moodScoreDisplay = document.getElementById('moodScoreDisplay');
            
            if (moodSlider && moodScoreDisplay) {
                moodSlider.addEventListener('input', function() {
                    moodScoreDisplay.textContent = this.value;
                });
            }
            
            // åŠ è½½å¿ƒæƒ…æ—¥è®°
            loadMoodDiaries();
        }
        
        async function addMoodDiary() {
            const moodType = document.getElementById('moodType').value;
            const moodScore = document.getElementById('moodScore').value;
            const diaryContent = document.getElementById('diaryContent').value.trim();
            const weather = document.getElementById('weather').value.trim();
            const memorialId = getMemorialId();
            
            if (!diaryContent) {
                alert('è¯·å¡«å†™å¿ƒæƒ…å†…å®¹');
                return;
            }
            
            if (!memorialId) {
                alert('æ— æ³•è·å–çºªå¿µé¦†ä¿¡æ¯');
                return;
            }
            
            try {
                const formData = new FormData();
                formData.append('memorial_id', memorialId);
                formData.append('mood_type', moodType);
                formData.append('mood_score', moodScore);
                formData.append('diary_content', diaryContent);
                formData.append('weather', weather);
                
                const response = await fetch('/api/mood-diary', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert('å¿ƒæƒ…æ—¥è®°è®°å½•æˆåŠŸï¼');
                    document.getElementById('diaryContent').value = '';
                    document.getElementById('weather').value = '';
                    loadMoodDiaries(); // é‡æ–°åŠ è½½æ—¥è®°
                } else {
                    alert('è®°å½•å¤±è´¥ï¼š' + data.error);
                }
            } catch (error) {
                console.error('è®°å½•å¿ƒæƒ…æ—¥è®°å¤±è´¥:', error);
                alert('è®°å½•å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
            }
        }
        
        async function loadMoodDiaries() {
            const memorialId = getMemorialId();
            if (!memorialId) return;
            
            try {
                const response = await fetch(`/api/mood-diaries/${memorialId}`);
                const data = await response.json();
                
                if (data.success) {
                    displayMoodDiaries(data.diaries);
                }
            } catch (error) {
                console.error('åŠ è½½å¿ƒæƒ…æ—¥è®°å¤±è´¥:', error);
            }
        }
        
        function displayMoodDiaries(diaries) {
            const diariesList = document.getElementById('moodDiariesList');
            if (!diariesList) return;
            
            if (diaries.length === 0) {
                diariesList.innerHTML = '<p style="text-align: center; color: #999; padding: 20px;">è¿˜æ²¡æœ‰å¿ƒæƒ…æ—¥è®°ï¼Œå¿«æ¥è®°å½•æ‚¨çš„å¿ƒæƒ…å§...</p>';
                return;
            }
            
            const moodEmojis = {
                'happy': 'ğŸ˜Š',
                'sad': 'ğŸ˜¢',
                'peaceful': 'ğŸ˜Œ',
                'nostalgic': 'ğŸ¥º',
                'grateful': 'ğŸ™'
            };
            
            diariesList.innerHTML = diaries.map(diary => `
                <div class="mood-diary-item">
                    <div class="mood-diary-header">
                        <div class="mood-info">
                            <span class="mood-emoji">${moodEmojis[diary.mood_type] || 'ğŸ˜Š'}</span>
                            <span class="mood-score">${diary.mood_score}/10</span>
                        </div>
                        <span class="diary-time">${formatTime(diary.created_at)}</span>
                    </div>
                    <div class="diary-content">${diary.diary_content}</div>
                    ${diary.weather ? `<div class="diary-weather">ğŸŒ¤ï¸ ${diary.weather}</div>` : ''}
                </div>
            `).join('');
        }
        
        // ========== ç…§ç‰‡è½®æ’­åŠŸèƒ½ ==========
        let currentSlide = 0;
        let slides = [];
        
        function initPhotoCarousel() {
            // è·å–ç…§ç‰‡åˆ—è¡¨å¹¶åˆå§‹åŒ–è½®æ’­
            const photos = getPhotoList();
            if (photos.length > 0) {
                setupCarousel(photos);
            }
        }
        
        function getPhotoList() {
            // ä»é¡µé¢ä¸­è·å–ç…§ç‰‡åˆ—è¡¨
            const photoElements = document.querySelectorAll('.photo-item img');
            return Array.from(photoElements).map(img => img.src);
        }
        
        function setupCarousel(photoUrls) {
            slides = photoUrls;
            const wrapper = document.getElementById('carouselWrapper');
            const dotsContainer = document.getElementById('carouselDots');
            
            if (!wrapper || !dotsContainer) return;
            
            // åˆ›å»ºè½®æ’­å¹»ç¯ç‰‡
            wrapper.innerHTML = photoUrls.map(url => `
                <div class="carousel-slide">
                    <img src="${url}" alt="å® ç‰©ç…§ç‰‡">
                </div>
            `).join('');
            
            // åˆ›å»ºè½®æ’­ç‚¹
            dotsContainer.innerHTML = photoUrls.map((_, index) => `
                <div class="carousel-dot ${index === 0 ? 'active' : ''}" onclick="goToSlide(${index})"></div>
            `).join('');
            
            // è‡ªåŠ¨è½®æ’­
            if (photoUrls.length > 1) {
                setInterval(() => {
                    changeSlide(1);
                }, 5000);
            }
        }
        
        function changeSlide(direction) {
            if (slides.length <= 1) return;
            
            currentSlide = (currentSlide + direction + slides.length) % slides.length;
            updateCarousel();
        }
        
        function goToSlide(index) {
            currentSlide = index;
            updateCarousel();
        }
        
        function updateCarousel() {
            const wrapper = document.getElementById('carouselWrapper');
            const dots = document.querySelectorAll('.carousel-dot');
            
            if (wrapper) {
                wrapper.style.transform = `translateX(-${currentSlide * 100}%)`;
            }
            
            // æ›´æ–°è½®æ’­ç‚¹çŠ¶æ€
            dots.forEach((dot, index) => {
                dot.classList.toggle('active', index === currentSlide);
            });
        }
        
        // ========== è®¿é—®ç»Ÿè®¡åŠŸèƒ½ ==========
        async function loadVisitStats() {
            const memorialId = getMemorialId();
            if (!memorialId) return;
            
            try {
                const response = await fetch(`/api/visit-stats/${memorialId}`);
                const data = await response.json();
                
                if (data.success) {
                    displayVisitStats(data.stats);
                }
            } catch (error) {
                console.error('åŠ è½½è®¿é—®ç»Ÿè®¡å¤±è´¥:', error);
            }
        }
        
        function displayVisitStats(stats) {
            document.getElementById('totalVisits').textContent = stats.total_visits;
            document.getElementById('uniqueVisitors').textContent = stats.unique_visitors;
            
            if (stats.last_visit) {
                document.getElementById('lastVisit').textContent = formatTime(stats.last_visit);
            } else {
                document.getElementById('lastVisit').textContent = '-';
            }
        }
        
        async function recordVisit() {
            const memorialId = getMemorialId();
            if (!memorialId) return;
            
            try {
                const formData = new FormData();
                formData.append('memorial_id', memorialId);
                
                await fetch('/api/visit-stat', {
                    method: 'POST',
                    body: formData
                });
            } catch (error) {
                console.error('è®°å½•è®¿é—®å¤±è´¥:', error);
            }
        }
        

        
        // è¾…åŠ©å‡½æ•°ï¼šæ ¼å¼åŒ–æ—¶é—´
        function formatTime(timestamp) {
            if (!timestamp) return '';
            
            const date = new Date(timestamp);
            const now = new Date();
            const diff = now - date;
            
            if (diff < 60000) { // 1åˆ†é’Ÿå†…
                return 'åˆšåˆš';
            } else if (diff < 3600000) { // 1å°æ—¶å†…
                return `${Math.floor(diff / 60000)}åˆ†é’Ÿå‰`;
            } else if (diff < 86400000) { // 1å¤©å†…
                return `${Math.floor(diff / 3600000)}å°æ—¶å‰`;
            } else if (diff < 2592000000) { // 30å¤©å†…
                return `${Math.floor(diff / 86400000)}å¤©å‰`;
            } else {
                return date.toLocaleDateString('zh-CN');
            }
        }
        

        

        

        

        

        

        

        

    </script>
</body>
</html>