<!--pages/personality-test/personality-test.wxml-->
<view class="container">
  <!-- 页面标题 -->
  <view class="page-header">
    <text class="page-title">宠物性格测试</text>
    <text class="page-subtitle">了解您的宠物，创建专属纪念馆</text>
  </view>
  
  <!-- 进度条 -->
  <view class="progress-section">
    <text class="progress-text">第 {{currentQuestion}} 题 / 共 {{totalQuestions}} 题</text>
    <view class="progress-bar">
      <view class="progress-fill" style="width: {{progress}}%"></view>
    </view>
  </view>
  
  <!-- 宠物基本信息 -->
  <view wx:if="{{showPetInfo}}" class="pet-info-section">
    <text class="section-title">宠物基本信息</text>
    <view class="form-grid">
      <view class="form-group">
        <text class="form-label">宠物姓名</text>
        <input 
          class="form-input" 
          type="text" 
          placeholder="请输入宠物姓名"
          value="{{petInfo.name}}"
          bindinput="onPetNameInput"
        />
      </view>
      
      <view class="form-group">
        <text class="form-label">宠物品种</text>
        <input 
          class="form-input" 
          type="text" 
          placeholder="请输入宠物品种"
          value="{{petInfo.breed}}"
          bindinput="onPetBreedInput"
        />
      </view>
      
      <view class="form-group">
        <text class="form-label">宠物年龄</text>
        <input 
          class="form-input" 
          type="number" 
          placeholder="请输入宠物年龄"
          value="{{petInfo.age}}"
          bindinput="onPetAgeInput"
        />
      </view>
      
      <view class="form-group">
        <text class="form-label">宠物性别</text>
        <picker 
          class="form-picker" 
          mode="selector" 
          range="{{genderOptions}}"
          value="{{petInfo.genderIndex}}"
          bindchange="onGenderChange"
        >
          <view class="picker-text">{{petInfo.gender || '请选择性别'}}</view>
        </picker>
      </view>
    </view>
  </view>
  
  <!-- 问题容器 -->
  <view wx:if="{{currentQuestionData}}" class="question-container">
    <text class="question-text">第{{currentQuestion}}题：{{currentQuestionData.question}}</text>
    <view class="answer-options">
      <view 
        wx:for="{{currentQuestionOptions}}" 
        wx:key="*this"
        class="answer-option {{answers[currentQuestion] === item ? 'selected' : ''}}"
        bindtap="selectAnswer"
        data-option="{{item}}"
      >
        {{item}}
      </view>
    </view>
  </view>
  
  <!-- 测试结果 -->
  <view wx:if="{{showResult}}" class="result-section">
    <text class="result-title">测试结果</text>
    <view class="result-content">
      <text class="result-text">{{personalityResult}}</text>
    </view>
    
    <view class="memorial-form">
      <text class="form-label">纪念馆描述</text>
      <textarea 
        class="form-textarea" 
        placeholder="请输入纪念馆描述"
        value="{{memorialInfo.description}}"
        bindinput="onDescriptionInput"
      ></textarea>
    </view>
  </view>
  
  <!-- 导航按钮 -->
  <view class="navigation">
    <button 
      wx:if="{{currentQuestion > 1 || showPetInfo}}" 
      class="btn btn-secondary" 
      bindtap="prevStep"
    >
      上一步
    </button>
    
    <button 
      wx:if="{{!showResult && (showPetInfo || currentQuestion < totalQuestions)}}" 
      class="btn btn-primary" 
      bindtap="nextStep"
      disabled="{{!canProceed}}"
    >
      下一步
    </button>
    
    <button 
      wx:if="{{showResult}}" 
      class="btn btn-primary" 
      bindtap="createMemorial"
      disabled="{{loading}}"
    >
      {{loading ? '创建中...' : '创建纪念馆'}}
    </button>
  </view>
</view>